!function(n){"use strict";function i(t,e){var i=this;wp&&wp.template&&wp.media&&(i.$el=t,i.options=e,i.settings=i.options.settings,i.$attachment=i.$el.find(i.options.attachment),i.$color=i.$el.find(i.options.color),i.$image=i.$el.find(i.options.image),i.$position=i.$el.find(i.options.position),i.$repeat=i.$el.find(i.options.repeat),i.$size=i.$el.find(i.options.size),i.$width=i.$el.find(i.options.width),i.$height=i.$el.find(i.options.height),i.$canvas=i.$el.find(i.options.canvas),i.$color.wpColorPicker(n.extend(i.settings.color,{change:function(t,e){i.update_canvas(i.$color.attr("data-style"),e.color.toString())},clear:function(){i.update_canvas(i.$color.attr("data-style"),"transparent")}})),i.$el.find(i.options.editbutton).on("click",n.proxy(i.edit_image,i)),n([i.$position,i.$width,i.$height]).each(function(){n(this).on("keyup",i.delay(n.proxy(i.input_keyup,i),500))}),n([i.$attachment,i.$repeat,i.$size]).each(function(){n(this).on("change",n.proxy(i.select_change,i))}),i.update_canvas())}i.prototype.$canvas=null,i.prototype.$attachment=null,i.prototype.$color=null,i.prototype.$image=null,i.prototype.$position=null,i.prototype.$repeat=null,i.prototype.$size=null,i.prototype.$width=null,i.prototype.$height=null,i.prototype.$el=null,i.prototype.media=null,i.prototype.options=null,i.prototype.settings=null,i.prototype.delay=function(i,a){var n=0;return function(){var t=this,e=arguments;clearTimeout(n),n=setTimeout(function(){i.apply(t,e)},a||0)}},i.prototype.edit_image=function(t){t.preventDefault();var e=this,i=n(t.target||t.currentTarget).closest("[data-u]");e._open_medialib({library:{type:e.settings.upload.type},multiple:!1,title:e.settings.upload.title},i)},i.prototype.input_keyup=function(t){t.preventDefault();var e=n(t.target||t.currentTarget);this.update_canvas(e.attr("data-style"),e.val())},i.prototype.select_change=function(t){t.preventDefault();var e=n(t.target||t.currentTarget);this.update_canvas(e.attr("data-style"),e.children("option:selected").val())},i.prototype.update_canvas=function(t,e){var a=this;2===arguments.length&&""!==e?(e="background-image"==t?"url('"+e+"')":e,a.$canvas.css(t,e)):(n([a.$image,a.$position,a.$width,a.$height]).each(function(){var t=n(this),e=t.attr("data-style"),i=t.val();i="background-image"==e?"url('"+i+"')":i,a.$canvas.css(e,i)}),n([a.$attachment,a.$repeat,a.$size]).each(function(){var t=n(this),e=t.attr("data-style");a.$canvas.css(e,t.children("option:selected").val())}))},i.prototype._attach_items=function(t){var e=this;if(1===t.length){e.$image.val(t[0].url);var i=e.$image.closest("[data-u]");i.attr("data-u",t[0].id),i.find('input[type="hidden"]:first-child').val(t[0].id),i.find(".upload-url").attr("href",t[0].url),i.find(".upload-url img").attr("src",t[0].url),e.update_canvas("background-image",t[0].url)}},i.prototype._open_medialib=function(t,e){var i=this;if(i.media)return i._update_selectlist(e),void i.media.open();i.media=wp.media.frames.file_frame=wp.media(t),i._update_selectlist(e),i.media.on("select",function(){i.selections=i.media.state().get("selection"),i._attach_items(i.selections.toJSON()),wp.media.model.settings.post.id=i.settings.upload.wpid}),i.media.open()},i.prototype._update_selectlist=function(e){var i=this;i.media.on("open",function(){i.selections=i.media.state().get("selection");var t=wp.media.attachment(e.attr("data-u"));t.fetch(),i.selections.add(t?[t]:[])})};var e={init:function(t){if(!this.length)return!1;var e={attachment:".input-attachment",color:".input-color",image:".input-image",position:".input-position",repeat:".input-repeat",size:".input-size",width:".input-width",height:".input-height",canvas:".canvas",editbutton:".edit-button",settings:{color:{defaultColor:!0,hide:!0,palettes:!0,width:255,mode:"hsv",type:"full",slider:"horizontal"},upload:{media:null,size:"full",title:!1,type:"image",wpid:null}}};return this.each(function(){t&&n.extend(e,t),new i(n(this),e)})}};n.fn.dionysosBackground=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(n.error("Method "+t+" does not exist on dionysosBackground"),!1):e.init.apply(this,arguments)}}(window.jQuery,window.wp);