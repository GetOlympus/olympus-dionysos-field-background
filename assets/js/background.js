!function(n){"use strict";function a(t,e){var a=this;wp&&wp.template&&wp.media&&(a.$el=t,a.options=e,a.settings=a.options.settings,a.$attachment=a.$el.find(a.options.attachment),a.$color=a.$el.find(a.options.color),a.$image=a.$el.find(a.options.image),a.$position=a.$el.find(a.options.position),a.$repeat=a.$el.find(a.options.repeat),a.$size=a.$el.find(a.options.size),a.$canvas=a.$el.find(a.options.canvas),a.$color.wpColorPicker(n.extend(a.settings.color,{change:function(t,e){a.update_canvas(a.$color.attr("data-style"),e.color.toString())},clear:function(t){a.update_canvas(a.$color.attr("data-style"),"transparent")}})),a.$el.find(a.options.editbutton).on("click",n.proxy(a.edit_image,a)),a.$position.on("keyup",a.delay(n.proxy(a.input_keyup,a),500)),n([a.$attachment,a.$repeat,a.$size]).each(function(){n(this).on("change",n.proxy(a.select_change,a))}),a.update_canvas())}a.prototype.$canvas=null,a.prototype.$attachment=null,a.prototype.$color=null,a.prototype.$image=null,a.prototype.$position=null,a.prototype.$repeat=null,a.prototype.$size=null,a.prototype.$el=null,a.prototype.media=null,a.prototype.options=null,a.prototype.settings=null,a.prototype.delay=function(a,i){var n=0;return function(){var t=this,e=arguments;clearTimeout(n),n=setTimeout(function(){a.apply(t,e)},i||0)}},a.prototype.edit_image=function(t){t.preventDefault();var e=this,a=n(t.target||t.currentTarget).closest("[data-u]");e._open_medialib({library:{type:e.settings.upload.type},multiple:!1,title:e.settings.upload.title},a)},a.prototype.input_keyup=function(t){t.preventDefault();var e=n(t.target||t.currentTarget),a=e.attr("data-style"),i=e.val();this.update_canvas(a,i)},a.prototype.select_change=function(t){t.preventDefault();var e=n(t.target||t.currentTarget),a=e.attr("data-style"),i=e.children("option:selected").val();this.update_canvas(a,i)},a.prototype.update_canvas=function(t,e){var i=this;2===arguments.length&&""!==e?i.$canvas.css(t,e):(n([i.$image,i.$position]).each(function(){var t=n(this),e=t.attr("data-style"),a="background-image"==e?"url("+t.val()+")":t.val();i.$canvas.css(e,a)}),n([i.$attachment,i.$repeat,i.$size]).each(function(){var t=n(this),e=t.attr("data-style");i.$canvas.css(e,t.children("option:selected").val())}))},a.prototype._attach_items=function(t){var e=this;if(1===t.length){e.$image.val(t[0].url);var a=e.$image.closest("[data-u]");a.attr("data-u",t[0].id),a.find('input[type="hidden"]:first-child').val(t[0].id),a.find(".upload-url").attr("href",t[0].url),a.find(".upload-url img").attr("src",t[0].url),e.update_canvas()}},a.prototype._open_medialib=function(t,e){var a=this;if(a.media)return a._update_selectlist(e),void a.media.open();a.media=wp.media.frames.file_frame=wp.media(t),a._update_selectlist(e),a.media.on("select",function(){a.selections=a.media.state().get("selection"),a._attach_items(a.selections.toJSON()),wp.media.model.settings.post.id=a.settings.upload.wpid}),a.media.open()},a.prototype._update_selectlist=function(e){var a=this;a.media.on("open",function(){a.selections=a.media.state().get("selection");var t=wp.media.attachment(e.attr("data-u"));t.fetch(),a.selections.add(t?[t]:[])})};var e={init:function(t){if(!this.length)return!1;var e={attachment:".input-attachment",color:".input-color",image:".input-image",position:".input-position",repeat:".input-repeat",size:".input-size",canvas:".canvas",editbutton:".edit-button",settings:{color:{defaultColor:!0,hide:!0,palettes:!0,width:255,mode:"hsv",type:"full",slider:"horizontal"},upload:{media:null,size:"full",title:!1,type:"image",wpid:null}}};return this.each(function(){t&&n.extend(e,t),new a(n(this),e)})}};n.fn.dionysosBackground=function(t){return e[t]?e[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?(n.error("Method "+t+" does not exist on dionysosBackground"),!1):e.init.apply(this,arguments)}}(window.jQuery,window.wp);